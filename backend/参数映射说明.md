# FSU 配置参数与 LOGIN 报文映射关系

## 概述

前端配置界面中的每个参数都直接对应 LOGIN 报文中的特定字段。当您在前端修改配置并激活后，系统会在下次启动心跳服务时使用新的参数值生成 LOGIN 报文。

## 详细映射关系

### 1. 基本信息

| 前端字段名 | LOGIN 报文字段 | 说明             | 示例值           |
| ---------- | -------------- | ---------------- | ---------------- |
| `fsuId`    | `<FsuId>`      | FSU 设备唯一标识 | `61082143802203` |
| `fsuCode`  | `<FsuCode>`    | FSU 设备编码     | `61082143802203` |

### 2. 网络信息

| 前端字段名          | LOGIN 报文字段        | 说明         | 示例值                               |
| ------------------- | --------------------- | ------------ | ------------------------------------ |
| `macId`             | `<MacId>`             | MAC 地址     | `869221025266666`                    |
| `imsiId`            | `<ImsiId>`            | IMSI 号码    | `460068161666666`                    |
| `networkType`       | `<NetworkType>`       | 网络类型     | `4G`                                 |
| `lockedNetworkType` | `<LockedNetworkType>` | 锁定网络类型 | `LTE`                                |
| `carrier`           | `<Carrier>`           | 运营商代码   | `CU`(联通) / `CT`(电信) / `CM`(移动) |

### 3. 厂商信息

| 前端字段名      | LOGIN 报文字段    | 说明         | 示例值         |
| --------------- | ----------------- | ------------ | -------------- |
| `nmVendor`      | `<NMVendor>`      | 网管厂商     | `大唐`         |
| `nmType`        | `<NMType>`        | 网管型号     | `DTM-W101T`    |
| `fsuVendor`     | `<FSUVendor>`     | FSU 软件厂商 | `ZXLW`         |
| `fsuManufactor` | `<FSUManufactor>` | FSU 硬件厂商 | `ZXLW`         |
| `fsuType`       | `<FSUType>`       | FSU 型号     | `ZNV EISUA X7` |

### 4. 版本信息

| 前端字段名        | LOGIN 报文字段 | 说明       | 示例值                  |
| ----------------- | -------------- | ---------- | ----------------------- |
| `softwareVersion` | `<Version>`    | 软件版本号 | `24.1.HQ.FSU.LW.4417.R` |

### 5. 设备列表

| 前端字段名 | LOGIN 报文字段 | 说明                   | 示例值              |
| ---------- | -------------- | ---------------------- | ------------------- |
| `devices`  | `<DeviceList>` | 设备 ID 数组，每行一个 | 转换为 XML 设备列表 |

**设备列表转换示例：**

```
前端输入（每行一个设备ID）:
61082140601589
61082141820991
61082140702618

转换为LOGIN报文：
<DeviceList>
  <Device Id="61082140601589" Code="61082140601589"/>
  <Device Id="61082141820991" Code="61082141820991"/>
  <Device Id="61082140702618" Code="61082140702618"/>
</DeviceList>
```

### 6. VPN 配置

| 前端字段名         | LOGIN 报文字段                                | 说明        | 示例值                                  |
| ------------------ | --------------------------------------------- | ----------- | --------------------------------------- |
| `mainVPN`          | `<MainVPN>`, `<MainVPN_One>`, `<MainVPN_Two>` | 主 VPN 地址 | `sn.toweraiot.cn,sn.toweraiot.cn`       |
| `disasterRecovery` | `<Disaster_Recovery_One>`                     | 灾备地址    | `zb-sn.toweraiot.cn,zb-sn.toweraiot.cn` |

### 7. 服务器配置

| 前端字段名        | 用途                        | 说明                         | 示例值            |
| ----------------- | --------------------------- | ---------------------------- | ----------------- |
| `scServerAddress` | 发送 LOGIN 请求的目标服务器 | 不在报文中，用于确定请求 URL | `sn.toweraiot.cn` |

### 8. 自动获取字段

| 字段名       | LOGIN 报文字段 | 说明          | 获取方式            |
| ------------ | -------------- | ------------- | ------------------- |
| `internalIP` | `<FsuIP>`      | FSU 的内网 IP | 系统自动检测 VPN IP |

## 固定字段

以下字段在 LOGIN 报文中是固定值，不可配置：

| LOGIN 报文字段    | 固定值     | 说明           |
| ----------------- | ---------- | -------------- |
| `<UserName>`      | `1111`     | 登录用户名     |
| `<PaSCword>`      | `1111`     | 登录密码       |
| `<Internet_mode>` | `wireless` | 网络接入方式   |
| `<Reg_Mode>`      | `2`        | 注册模式       |
| `<FSUClass>`      | `INTSTAN`  | FSU 应用类型   |
| `<DictVersion>`   | `1`        | 信号量字典版本 |

## 配置生效流程

1. **前端配置**：在配置管理界面修改参数
2. **保存配置**：配置保存到数据库
3. **激活配置**：将配置设为当前活动配置
4. **重启服务**：如果心跳服务正在运行，系统会自动重启以应用新配置
5. **生成报文**：下次发送 LOGIN 请求时使用新的配置参数

## 使用示例

### 场景 1：更改软件版本

```
前端操作：将 softwareVersion 从 "24.1.HQ.FSU.LW.4417.R" 改为 "25.1.HQ.FSU.TT.AA01.R"
报文影响：<Version>25.1.HQ.FSU.TT.AA01.R</Version>
```

### 场景 2：更改运营商

```
前端操作：将 carrier 从 "CU" 改为 "CT"
报文影响：<Carrier>CT</Carrier>
```

### 场景 3：修改设备列表

```
前端操作：在设备列表中添加新设备ID "61082140702620"
报文影响：<DeviceList>中新增 <Device Id="61082140702620" Code="61082140702620"/>
```

## 注意事项

1. **参数验证**：前端会验证必填字段和格式
2. **实时生效**：配置激活后，如果心跳服务正在运行会自动重启
3. **备份建议**：修改重要配置前建议创建备份配置
4. **网络影响**：修改网络相关参数可能影响连接稳定性
