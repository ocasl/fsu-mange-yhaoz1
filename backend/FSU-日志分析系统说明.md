# FSU 接口日志分析系统

## 概述

针对您遇到的"GET FSUINFO 接口连接超时"问题，我已经为您创建了一套完整的 FSU 接口日志分析和网络诊断系统。

## 主要功能

### 1. 详细的接口日志记录

- **自动记录**：所有 FSU 接口调用都会自动记录详细日志
- **标准格式**：与您提供的日志格式完全一致
- **错误分析**：自动分析错误类型并提供解决建议

### 2. 网络诊断功能

- **连接超时检测**：自动检测连接超时并触发网络诊断
- **多层次诊断**：从 DNS 到端口连通性的全面检查
- **环境分析**：分析您的网络环境（VPN、WiFi 等）

### 3. 错误分析和建议

- **智能分析**：根据错误类型提供针对性分析
- **解决方案**：提供具体的解决步骤和命令

## 使用方法

### 快速诊断您的问题

```bash
# 进入backend目录
cd backend

# 运行诊断工具
node diagnose-network.js
```

### 测试 FSU 日志分析器

```bash
# 测试日志分析功能
node test-fsu-log-analyzer.js
```

### 查看详细日志

日志文件位置：

- `backend/logs/fsu-interface.log` - FSU 接口详细日志
- `backend/logs/fsu-errors.log` - 错误日志
- `backend/logs/combined.log` - 综合日志

## 针对您问题的分析

### 您的错误情况

```
接口名称: GET FSUINFO
URL: 192.168.2.1
开始时间: 2025-09-04 11:36:25
错误原因: nested exception is:java.net.SocketTimeoutException: connect timed out
结果: null
请求耗时: 15016ms
结束时间: 2025-09-04 11:36:40
```

### 可能的原因

1. **目标服务器问题**：192.168.2.1 可能没有运行 FSU 服务
2. **端口问题**：默认尝试连接 8080 端口，但服务可能在其他端口
3. **网络配置问题**：虽然您的网络环境正常，但目标服务器不响应
4. **防火墙阻拦**：路由器或系统防火墙可能阻止了连接

### 推荐解决步骤

#### 1. 确认目标服务器

```cmd
# 测试基本连通性
ping 192.168.2.1

# 测试端口连通性
telnet 192.168.2.1 8080
```

#### 2. 检查服务器配置

- 确认 SC 服务器的实际 IP 地址
- 确认 SC 服务器运行的端口号
- 检查 SC 服务器是否正常运行

#### 3. 扫描开放端口

```cmd
# 使用nmap扫描开放端口
nmap -p 1-9000 192.168.2.1
```

#### 4. 更新配置文件

编辑 `backend/config/sc.js`：

```javascript
module.exports = {
  host: "实际的SC服务器IP", // 可能不是192.168.2.1
  port: "实际的端口号", // 可能不是8080
  // ... 其他配置
};
```

## 新增的文件说明

### 核心组件

- `utils/fsuLogAnalyzer.js` - FSU 接口日志分析器
- `utils/networkDiagnostics.js` - 网络诊断工具
- `test-fsu-log-analyzer.js` - 测试脚本
- `diagnose-network.js` - 网络诊断脚本

### 增强的服务

- `services/scService.js` - 已集成日志分析器

## 输出示例

当发生连接超时时，系统会自动输出类似以下的详细日志：

```
================================================================================
标准FSU接口日志明细
================================================================================
接口名称: GET FSUINFO
URL: http://192.168.2.1:8080
开始时间: 2025-01-21 11:36:25
结束时间: 2025-01-21 11:36:40
请求耗时: 15016ms
错误原因: nested exception is:java.net.SocketTimeoutException: connect timed out
结果: null

请求报文:
<?xml version="1.0" encoding="UTF-8"?>
<Request>
  <PK_Type>
    <Name>GET FSUINFO</Name>
    <Code> 1701 </Code>
  </PK_Type>
  <info>
    <Fsuld>6108214380203 </FSuld>
    <FsuCode>61082143802203</FsuCode>
  </Info>
</Request>

响应报文: null

🔍 错误分析:
类型: 连接超时

可能原因:
  1. 网络连接不稳定
  2. 目标服务器响应慢
  3. VPN连接问题
  4. 防火墙阻挡
  5. 服务器负载过高

建议解决方案:
  1. 检查网络连接状态
  2. 确认VPN连接正常
  3. 增加请求超时时间
  4. 检查目标服务器状态
  5. 使用网络诊断工具测试连通性
================================================================================
```

## 技术特点

1. **标准化日志格式**：完全符合您提供的日志格式要求
2. **智能错误分析**：根据错误类型自动提供解决建议
3. **网络诊断集成**：超时错误自动触发网络诊断
4. **统计功能**：提供接口调用成功率和错误类型统计
5. **跨平台支持**：支持 Windows 和 Linux 环境

## 后续支持

系统现在会自动记录所有 FSU 接口调用的详细信息，包括：

- 请求时间和耗时
- 完整的请求和响应报文
- 错误分析和建议
- 网络诊断结果

您可以随时查看日志文件获取详细的调试信息，或运行诊断工具来分析网络问题。
