# FSU 管理系统 - 用户管理功能使用指南

## 功能概述

本系统新增了完整的用户管理和操作记录功能，支持总账号和子账号的管理，可以实时监控所有用户的操作行为。

## 主要功能

### 1. 用户角色管理

- **总账号（管理员）**：可以查看所有用户的操作记录，可以注册新的子账号
- **子账号（普通用户）**：只能查看自己的操作记录，不能注册新用户

### 2. 操作记录监控

- 自动记录所有用户的操作行为
- 详细记录操作时间、用户、模块、类型、结果等信息
- 支持操作统计和数据分析

### 3. 用户管理

- 用户注册（仅总账号可操作）
- 用户状态管理（启用/禁用）
- 用户信息查看和管理

## 系统初始化

### 1. 安装依赖

```bash
# 后端依赖
cd backend
npm install bcryptjs jsonwebtoken

# 前端依赖已包含在现有依赖中
```

### 2. 初始化管理员账号

```bash
cd backend
npm run init-admin
```

默认管理员账号信息：

- 用户名：`admin`
- 密码：`123456`
- 邮箱：`admin@fsu.com`

**⚠️ 重要：请登录后立即修改默认密码！**

## 使用说明

### 1. 登录系统

1. 打开系统首页
2. 输入用户名和密码
3. 点击登录按钮

### 2. 总账号功能

#### 用户管理

1. 点击左侧菜单"用户管理"
2. 查看所有用户列表和统计信息
3. 可以进行以下操作：
   - 新增用户（点击"新增用户"按钮）
   - 启用/禁用用户
   - 删除用户
   - 搜索和筛选用户

#### 注册子账号

1. 在用户管理页面点击"新增用户"
2. 填写用户信息：
   - 用户名（必填）
   - 密码（必填）
   - 确认密码（必填）
   - 真实姓名（可选）
   - 邮箱（可选）
   - 用户角色（选择"总账号"或"子账号"）
   - 用户描述（可选）
3. 点击"注册"按钮

#### 查看操作记录

1. 点击左侧菜单"操作记录"
2. 可以查看所有用户的操作记录
3. 支持以下功能：
   - 按用户筛选
   - 按操作模块筛选
   - 按操作结果筛选
   - 按时间范围筛选
   - 查看操作详情

### 3. 子账号功能

#### 查看个人操作记录

1. 点击左侧菜单"操作记录"
2. 只能查看自己的操作记录
3. 支持筛选和搜索功能

#### 系统功能

- 可以正常使用 FSU 管理、告警管理、配置管理等功能
- 所有操作都会被记录到操作日志中

## 操作记录详情

### 记录内容

- 操作时间
- 操作用户
- 操作模块（USER、ALARM、CONFIG、FSU、SYSTEM）
- 操作类型（CREATE、UPDATE、DELETE、VIEW、LOGIN 等）
- 操作描述
- 操作结果（成功/失败）
- 操作耗时
- 客户端 IP 地址
- 用户代理信息
- 请求和响应数据（如适用）

### 统计信息

- 总操作数
- 成功操作数
- 失败操作数
- 成功率统计

## 安全特性

### 1. 密码安全

- 密码使用 bcryptjs 进行哈希存储
- 支持密码强度验证

### 2. 认证和授权

- 使用 JWT Token 进行用户认证
- 基于角色的权限控制
- 自动处理 Token 过期

### 3. 操作审计

- 所有操作都有完整的审计日志
- 支持操作追溯和问题排查

## API 接口

### 用户管理接口

- `POST /api/user/login` - 用户登录
- `GET /api/user/me` - 获取当前用户信息
- `POST /api/user/register` - 注册用户（需管理员权限）
- `GET /api/user/list` - 获取用户列表（需管理员权限）
- `PATCH /api/user/:userId/status` - 更新用户状态（需管理员权限）
- `DELETE /api/user/:userId` - 删除用户（需管理员权限）

### 操作日志接口

- `GET /api/logs` - 获取操作日志列表
- `GET /api/logs/:logId` - 获取操作日志详情
- `GET /api/logs/stats/overview` - 获取操作统计信息
- `DELETE /api/logs/cleanup` - 清理旧日志（需管理员权限）

## 注意事项

1. **权限控制**：只有总账号可以注册新用户和查看所有操作记录
2. **数据安全**：密码等敏感信息不会出现在操作日志中
3. **性能优化**：操作日志记录采用异步方式，不影响正常业务
4. **存储管理**：建议定期清理旧的操作日志以节省存储空间

## 故障排除

### 1. 登录问题

- 检查用户名和密码是否正确
- 确认账号状态是否正常（未被禁用或锁定）
- 检查网络连接

### 2. 权限问题

- 确认当前用户的角色权限
- 子账号无法访问用户管理功能

### 3. 操作记录不显示

- 检查用户是否已登录
- 确认有相关操作记录存在
- 检查筛选条件设置

## 技术架构

### 后端技术

- Node.js + Express
- MongoDB + Mongoose
- JWT 认证
- bcryptjs 密码加密

### 前端技术

- React + Ant Design
- Axios HTTP 客户端
- 本地存储管理

### 数据库模型

- User 模型：用户信息管理
- OperationLog 模型：操作记录存储

## 更新历史

- v1.0.0 - 初始版本，包含完整的用户管理和操作记录功能
