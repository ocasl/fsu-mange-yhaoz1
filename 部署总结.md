# YhaoZ1 项目部署总结

## 部署信息
- **服务器IP**: 103.236.91.181
- **部署时间**: 2025-10-13
- **部署位置**: /var/www/yhaoz1/

## 已部署服务

### 1. 前端 (Frontend)
- **路径**: /var/www/yhaoz1/frontend/build/
- **访问地址**: http://103.236.91.181/
- **Web服务器**: Nginx 1.20.1
- **状态**: ✅ 运行中

### 2. 后端 (Backend)
- **路径**: /var/www/yhaoz1/backend/
- **端口**: 3001
- **API地址**: http://103.236.91.181/api/
- **进程管理**: PM2
- **状态**: ✅ 运行中 (PID: 20148)

### 3. 数据库 (MongoDB)
- **版本**: MongoDB 4.4.29
- **端口**: 27017 (仅本地访问)
- **状态**: ✅ 运行中

### 4. Node.js 环境
- **版本**: Node.js v16.20.2
- **包管理器**: npm 8.19.4
- **安装位置**: /usr/local/node-v16.20.2-linux-x64/

## 服务端口状态

| 服务 | 端口 | 监听地址 | 状态 |
|------|------|----------|------|
| Nginx | 8080 | 0.0.0.0 | ✅ 运行中 |
| Backend (Node.js) | 3001 | :: (IPv6 all) | ✅ 运行中 |
| MongoDB | 27017 | 127.0.0.1 | ✅ 运行中 |

> **注意**: 使用8080端口而非80端口，因为国内云服务器未备案域名禁止使用80/443端口。

## 配置文件位置

### Nginx 配置
- 主配置: `/etc/nginx/nginx.conf`
- 项目配置: `/etc/nginx/conf.d/yhaoz1.conf`

### 后端配置
- 环境变量: `/var/www/yhaoz1/backend/config.env`
- CORS设置: `http://103.236.91.181:8080`

### PM2 配置
- 进程名: `yhaoz1-backend`
- 自动启动: ✅ 已配置 (systemd)
- 配置文件: `/root/.pm2/dump.pm2`

## 开机自启配置

所有服务均已配置为开机自启：
- ✅ Nginx: `systemctl enable nginx`
- ✅ MongoDB: `systemctl enable mongod`
- ✅ PM2: `systemctl enable pm2-root`

## 常用管理命令

### 查看服务状态
```bash
# 查看所有服务
systemctl status nginx
systemctl status mongod
pm2 status

# 查看后端日志
pm2 logs yhaoz1-backend
```

### 重启服务
```bash
# 重启Nginx
systemctl restart nginx

# 重启后端
pm2 restart yhaoz1-backend

# 重启MongoDB
systemctl restart mongod
```

### 更新代码
```bash
# 更新后端
cd /var/www/yhaoz1/backend
pm2 stop yhaoz1-backend
# 上传新代码
pm2 start yhaoz1-backend

# 更新前端
cd /var/www/yhaoz1/frontend
# 上传新的build文件夹
systemctl reload nginx
```

## 访问地址

- **前端**: http://103.236.91.181:8080/
- **后端API**: http://103.236.91.181:8080/api/

## 注意事项

1. MongoDB仅监听本地127.0.0.1，增强安全性
2. 后端通过Nginx反向代理，统一对外提供服务
3. PM2已配置自动重启和开机自启
4. 所有服务日志位置：
   - Nginx日志: `/var/log/nginx/`
   - 后端日志: `/var/www/yhaoz1/backend/logs/`
   - MongoDB日志: `/var/log/mongodb/`
   - PM2日志: `/root/.pm2/logs/`

## 部署完成状态

✅ 所有服务已成功部署并运行
✅ 前端可正常访问
✅ 后端API已配置反向代理
✅ 数据库已启动
✅ 所有服务已配置开机自启

## 下一步建议

1. 创建管理员账户：
   ```bash
   cd /var/www/yhaoz1/backend
   npm run init-admin
   ```

2. 配置防火墙规则（如果需要）：
   ```bash
   firewall-cmd --permanent --add-service=http
   firewall-cmd --reload
   ```

3. 配置SSL证书（可选，用于HTTPS）

4. 配置数据库备份计划

